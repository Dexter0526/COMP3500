# 4. 해시 알고리즘

다양한 해시 알고리즘의 용도
- 해시(hash)는 컴퓨터 공학에서 매우 근본이 되는 알고리즘 중 하나

해시 함수의 정의
- 임의의 크기를 가진 값을 고정 크기의 값에 대응시키는 함수
- 수학에서의 함수의 정의도 만족해야 함
- 입력값이 같으면 언제나 출력값도 같아야 함(결정론적 작동)

분류
- (비암호학적) 해시 함수
- 함호학적 해시 함수


- 체크섬(검사합, checksum)
- 순환 중복 검사(cyclic redundancy check, CRC)

속성
- 효율성
- 균일성

## 균일성
- 해시 함수의 출력값이 고르게 분포될수록 균일성이 높음
- 흔히 좋은 해시 함수는 균일성이 높아야 한다
    - 출력 범위 안의 모든 값들이 동일한 확률로 나와야 함(균등 분포)
    - 해시 충돌이 적어 O(1) 해시 테이블을 기대할 수 잇음
- 완벽한 해시 함수 : 해시 충돌이 전혀 없는 함수

### 균일성의 측정
- 카이제곱 검정을 이용
  ![카이제곱 검정](./img/img.png "카이제곱 검정")
- 결과 : 0.95 ~ 1.05 사이면 균일한 분포를 가진 해시 함수
- 해시값이 덜 중복되게 버킷 수를 정할 것(소수 사용)
- 완벽한 '눈사태'가 나도록 해시 함수를 설계할 것
    - 입력값이 약간만 바뀌어도 출력값이 굉장히 많이 바뀌는 것
    - 엄격한 눈사태 기준(strict avalanche criterion, SAV)
        - 입력값에서 1비트를 뒤집으면 출력값의 각 비트가 뒤집힐 확률이 50%
        - 이 기준을 충족하는 해시 함수는 분포가 균일할 가능성이 매우 높음
    
### 지역 민감 해시(locality-sensitive hashing)
- 해시 충돌의 최소화 대신 최대화를 목표로 하는 알고리즘
- 비슷한 내용을 가진 데이터끼리 충돌해야 함
- 엄청나게 많은 데이터에서 비슷한 것들을 찾는 용도
    - 스팸 메일 찾기
    - 웹 검색 엔진에서 비슷한 문서 추천하기
    - 음원, 사진 등의 저작권 침해 검사
    - ...

## 효율성
- 보통 빠른 해시 함수를 선호
- 공간을 더 낭비해도 빠른 접근 속도를 선호
- 충돌이 좀 더 나더라도 더 빠른 함수를 선호
- 하드웨어 가속이 어려운 해시를 선호하는 경우도 있음

### 암호학적 해시 알고리즘의 추가 속성
- 역상 저항성(pre-image resistance)
- 제 2역상 저항성(second pre-image resistance)
- 충돌 저항성(collision resistance)

## (비암호학적) 해시 함수
- 보안적으로 문제없는 용도에 주로 사용
    - 데이터 저장 및 찾기
    - 저장/전송 중에 생긴 데이터 오류 탐지
    - 고유한 ID 생성
    - ...
- 모든 데이터에 대해 최고의 결과를 보장하는 해시 함수는 존재하지 않음
- 입력값에 따라 다른 해시 함수를 사용하는 확률적 알고리즘은 존재
    - 유니버셜 해싱
- 비트 패킹(bit-packing)도 해시 함수로 사용 가능
    - 균일성이 높지 않음

## 체크섬(checksum)
- 여러 데이터로부터 도출한 작은 크기의 데이터 하나
    - 보통 데이터에 있는 모든 바이트를 어떤 방식으로든 합함
- 해시 함수랑 매우 비슷한 개념
    - 출력값의 크기가 고정되어 있으면 해시 함수
- 용도 : 저장 혹은 전송 중에 발생한 오류를 찾아냄
    - 처음 데이터를 저장할 때 체크섬을 계산해 그것도 저장
    - 나중 데이터를 읽을 때 다시 체크섬을 계산
    - 처음 체크섬과 읽을 때 체크섬이 다르면 오류
    
### 체크섬 사용례
- 주민등록 번호 유효성 검사
- 신용카드 번호 유효성 검사
- ISBN의 유효성 검사
    - ISBN 10(국제 표준 도서 번호)
  
### 체크섬이 보장하는 것
- 간단한 산술 연산
- 계산이 빠르고 추가 메모리가 불필요
  - 네트워크 프로토콜에서 사용
  - 하드웨어로도 구현하기 쉬움
- 단, 모든 오류를 찾지는 못함

### 체크섬과 미러 사이트
- 웹사이트에서 유용한 프로그램을 배포할 경우 미러를 사용하기도 함
  - 한 웹사이트에서 트래픽이 감당이 안될 경우, 다른 웹사이트에서 대신 파일을 호스팅
- 미러 사이트에서 내 프로그램에 스파이웨어를 넣으면?
  - 내 웹사이트에 체크섬 값을 공개해 놓음
  - 사용자는 미러 사이트에서 받은 파일에 체크섬 알고리즘을 돌림
  - 일치하지 않으면 변조된 프로그램
  
## 패리티 비트(parity bit)
- 이진수로 저장된 데이터에 추가하는 1비트짜리 체크섬
- 보통 1바이트 단위로 많이 사용(7비트 데이터 + 1비트 패리티)

### 순환 중복 검사(cyclic redundancy check)
- 체크섬 알고리즘 중 하나
- 다항식의 나머지 연산을 이용하여 검사값을 만듦
  - 검사값은 보통 고정된 길이
  - 따라서 CRC 함수를 해시 함수로 사용하기도 함
- 다항식의 최고차항에 따라 CRC에 사용하는 비트 수가 달라짐
  - 각 항의 계수는 1 아니면 0
- ex) x^3 + x + 1 => 1011(총 4비트)
  - 011 (총 3비트)
  - 이건 CRC-3-GSM에 사용하는 다항식